
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resizable Rectangle Example</title>
   
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
   
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="cat.css">
</head>
<body style="background-color: #070c19;">
    <div id="itemModal" class="modal" >
        <div class="itemmodal-content" >
            <span class="itemclose" onclick="closeItemModal()">&times;</span> </br></br>
            <div style="justify-content: center; margin-top: 30px;">
                <div id="item-details" class="item-prop">
                    <label id="itemName" class="cname">Item Name: </label>
                </div>
                <div id="quantityControls" class="quantity-controls">
                    <label class="txt"> Add Quantity:</label>
                    <button class="quantity-btn" onclick="incrementQuantity()">+</button>
                    <span id="quantityValue">01</span>
                    <button class="quantity-btn" onclick="decrementQuantity()">-</button>
                </div>
                <div>
                    <div class="container-group">
                        <div class="spicy-level-container">
                            <label class="spicy-level txt">Spicy Level:</label>
                            <select id="spicyLevel" class="mdl-textfield__input" required>
                                <option value="select" class="spicy-level-option" selected>Select</option>
                                <option value="mild" class="spicy-level-option">Mild</option>
                                <option value="medium" class="spicy-level-option">Medium</option>
                                <option value="spicy" class="spicy-level-option">Spicy</option>
                                <option value="extra-spicy" class="spicy-level-option">Extra Spicy</option>
                            </select>
                        </div>
                        <div class="type-container" id="typeid">
                            <label class="type txt">Type:</label>
                            <select id="type" class="mdl-textfield__input" required>
                                <option value="select" class="type-option" selected>None</option>
                                <option value="Curry" class="type-option">Curry</option>
                                <option value="Bhuna" class="type-option">Bhuna</option>
                                <option value="Madras" class="type-option">Madras</option>
                                <option value="Jalfrezi" class="type-option">Jalfrezi</option>
                                <option value="Kadai" class="type-option">Kadai</option>
                                <option value="Tawa" class="type-option">Tawa</option>
                                <option value="Vandaloo" class="type-option">Vindaloo</option>
                                <option value="Palak" class="type-option">Palak</option>
                                <option value="Saag" class="type-option">Saag</option>
                                <option value="Methi" class="type-option">Methi</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="txt-area-container">
                    <label class="txt"> Add customer note here :</label>
                    <textarea id="notes" class="notes" name=" " rows="4" cols="50"></textarea>
                </div>
                
                <div class="button-container">
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect btn btn-lg mb-1 modbtn"  onclick="submitItem()">Submit</button>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect btn btn-lg mb-1 modbtn" onclick="closeItemModal()">Cancel</button>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect btn btn-lg mb-1 modbtn" onclick="removeItem()">Remove</button>
                </div>
    
            </div>
        </div>
    </div>
    <div class="main-con">
        <div class="top-header">
            <div class="top-style" style="display: flex; flex-direction: row; justify-content: space-between;">
                <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" href="../../tabels/tabels.html" target="_top">
                    <span class="material-icons">arrow_back</span>
                </a>
                <div class="top-style"> Order Id: 00001</div>
                <div class="top-style"> Dine-In</div>
                <button class="cart-logo" onclick="sideView()">
                    <span class="material-icons cart-logo">
                        shopping_cart
                    </span>
                    <div class="items-number" id="totalItems"></div>
                </button>
            </div>
        </div>
        <div class="bottom-con">
            <div class="left-content" >
                <div class="orange-bar">
                    <span class="orange-text">Items</span>
                </div>
                <div id="product-names" class="product-names">
                    <iframe src="" id="itemlist"></iframe>
                </div>
                <div class="orange-bar">
                    <span class="orange-text">Category</span>
                    <span class="orange-text" id="select-cat">Select Category</span>
                    <button style="visibility: hidden;" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect orange-button">
                        <span class="material-icons orange-icon">add</span>
                    </button>
                </div>
                <div class="category-names" id="categoryButtonsContainer"></div>
            </div>
            <div class="right-content">
                <div class="right-info" id="selectedTableInfo">
               </div>
               <div class="right-tag">
                   <div class="i-t">
                       <div class="name-item">Item</div>
                       <div class="name-space">
                           <div class="name-text">Qty</div>
                           <div class="name-text">unit Price</div>
                           <div class="name-text">Price</div>
                       </div>
                   </div>
               </div>
                <div class="item-div" id="item-div">
                   
                </div>
                <div class="total-tag">
                    <div class="i-t">
                        <div class="iname-item">Total items</div>
                        <div class="name-space">
                            <div class="total-text" id="totalItems1"></div>
                            <div class="total-text">Total Price</div>
                            <div class="total-text" id="totalprice"></div>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect act-button" onclick="handleHold()">
                        Hold
                    </button>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect act-button" onclick="handlePay()">
                        Pay
                    </button>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect act-button" onclick="handleClear()">
                        Clear
                    </button>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect act-button" onclick="handleClear()">
                        Void
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="./cat.js"></script>
    <script type="module"  src="../../admin/data.js"></script>

    <script>        
        window.addEventListener('message', function (event) {
            if (event.origin === window.location.origin) {
                var data = event.data;
                createNewDiv(data);
            }
        });

        function sideView() {
            var cartButton = document.querySelector('.cart-logo.cart');
            var rightContent  = document.querySelector('.right-content');

            rightContent.style.display = rightContent.style.display === 'none' ? 'block' : 'none';
        }

        document.addEventListener('DOMContentLoaded', function () {
            const container = document.querySelector('.bottom-con');
            const cartButton = document.querySelector('.cart-logo');

            cartButton.addEventListener('click', function () {
                container.classList.toggle('container-expanded');
            });
        });
        
        function createNewDiv(data) {
            if (data && data.itemName && data.quantity && data.price && data.totalPrice) {
                var itemDivContainer = document.getElementById('item-div');

                var newItemDiv = document.createElement('div');
                newItemDiv.className = 'item-add mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect btn btn-lg mb-1 custom-button';
                newItemDiv.id = 'item-add i-t';

                var itemNameDiv = document.createElement('div');
                itemNameDiv.className = 'iname-item';
                itemNameDiv.textContent = data.itemName;

                var nameSpaceDiv = document.createElement('div');
                nameSpaceDiv.className = 'name-space';

                var quantityDiv = document.createElement('div');
                quantityDiv.className = 'name-text';
                quantityDiv.id = 'qty';
                quantityDiv.textContent = data.quantity;

                var unitPriceDiv = document.createElement('div');
                unitPriceDiv.className = 'name-text';
                unitPriceDiv.id = 'unit-price';
                unitPriceDiv.textContent = data.price;

                var totalPriceDiv = document.createElement('div');
                totalPriceDiv.className = 'name-text';
                totalPriceDiv.id = 'price';
                totalPriceDiv.textContent = data.totalPrice;

                var spicyValue = data.spicyValue;
                var typeValue = data.typeValue;

                nameSpaceDiv.appendChild(quantityDiv);
                nameSpaceDiv.appendChild(unitPriceDiv);
                nameSpaceDiv.appendChild(totalPriceDiv);

                newItemDiv.appendChild(itemNameDiv);
                newItemDiv.appendChild(nameSpaceDiv);

                itemDivContainer.appendChild(newItemDiv);
                newItemDiv.onclick = function(){
                    var itemDetails = { name: itemNameDiv.textContent,
                                        price: unitPriceDiv.textContent,
                                        quantity: quantityDiv.textContent,
                                        spicyValue : data.spicyValue,
                                        typeValue: data.typeValue
                                    };
                    console.log(itemDetails);
                    openItem(itemDetails);
                }

                var totalItemsDiv = document.getElementById('totalItems');
                totalItemsDiv.textContent = itemDivContainer.children.length;

                var totalItems1Div = document.getElementById('totalItems1');
                totalItems1Div.textContent = itemDivContainer.children.length;

                var priceDiv = document.getElementById('totalprice');
                var totalItemsPrice = Array.from(itemDivContainer.children).reduce(function (total, item) {

                    var itemPrice = parseFloat(item.querySelector('.name-text#price').textContent.replace('£', ''));
                    return total + itemPrice;
                }, 0);

                priceDiv.textContent = '£' + totalItemsPrice.toFixed(2);
            
            } 
        }
        var selectedSpicyValue = ' '; 
        var selectedTypeValue = ' '; 

        const type = document.getElementById('type');
        function submitItem() {
            
            var selectedSpicyValue = document.getElementById("spicyLevel").value;

            if(type){
                var selectedTypeValue = document.getElementById("type").value;
                console.log(selectedTypeValue)
            }

            console.log("Selected Option: ", selectedSpicyValue);
            updateTotalItemsAndPrice();
            closeItemModal();
        }
        
        
        function openItem(itemDetails) {
            var modal = document.getElementById('itemModal');
            modal.style.display = 'block';

            var itemDetailsContainer = document.getElementById('item-details');
            itemDetailsContainer.innerHTML = '';

            var itemNameDiv = document.createElement("div");
            itemNameDiv.className = "item-name cname txt";
            itemNameDiv.textContent = itemDetails.name;
            var priceDiv = document.createElement("div");
            priceDiv.className = "item-price cname";
            priceDiv.textContent = itemDetails.price;

            itemDetailsContainer.appendChild(itemNameDiv);
            itemDetailsContainer.appendChild(priceDiv);

            if(selectedSpicyValue != ' ')
            {
                console.log(selectedSpicyValue);
            }else{
                if (itemDetails.spicyValue && itemDetails.spicyValue !== 'select' && itemDetails.typeValue && itemDetails.typeValue !== 'select') {
                    
                    document.getElementById('spicyLevel').value = itemDetails.spicyValue.toLowerCase();
                    selectedSpicyValue = itemDetails.spicyValue.toLowerCase();
                    
                    document.getElementById('type').value = itemDetails.typeValue;

                    document.getElementById('spicyLevel').style.display = 'block';
                    document.getElementById('typeid').style.display = 'visible';
                } else if (itemDetails.spicyValue && itemDetails.spicyValue !== 'select') {
                    
                    document.getElementById('spicyLevel').value = itemDetails.spicyValue.toLowerCase();
                    selectedSpicyValue = itemDetails.spicyValue.toLowerCase();
                    
                    document.getElementById('spicyLevel').style.display = 'block';

                    
                    document.getElementById('typeid').style.display = 'none';
                }
            }

            var quantityDisplay = document.getElementById('quantityValue');
            quantityDisplay.textContent = itemDetails.quantity;
        }



        function closeItemModal() {
            var modal = document.getElementById('itemModal');
            modal.style.display = 'none';
        }

        function removeItem() {
          
            var itemDivContainer = document.getElementById('item-div');

            if (itemDivContainer.children.length > 0) {

                var lastItem = itemDivContainer.lastElementChild;


                itemDivContainer.removeChild(lastItem);


                updateTotalItemsAndPrice();
                closeItemModal();
            }
        }
        
        var quantityValue = 1; 

        function incrementQuantity() {
            quantityValue++;
            updateQuantityDisplay();
        }

        function decrementQuantity() {
            if (quantityValue > 1) {
                quantityValue--;
                updateQuantityDisplay();
            }
        }

        function updateQuantityDisplay() {
            var quantityDisplay = document.getElementById('quantityValue');
            quantityDisplay.textContent = quantityValue.toString().padStart(2, '0');
        }
        function handleClear(){
            var itemDiv = document.getElementById('item-div');
            itemDiv.innerHTML = '';
            var priceDiv = document.getElementById('totalprice');
            priceDiv.innerHTML = '';
            var totalItemsDiv = document.getElementById('totalItems');
            totalItemsDiv.innerHTML = '';
            var totalItems1Div = document.getElementById('totalItems1');
            totalItems1Div.innerHTML = '';
        }



        function updateTotalItemsAndPrice() {
            var itemDivContainer = document.getElementById('item-div');
            var totalItemsDiv = document.getElementById('totalItems');
            var totalItems1Div = document.getElementById('totalItems1');
            var priceDiv = document.getElementById('totalprice');
            var itemsNumberSpan = document.querySelector('.items-number');

            totalItemsDiv.textContent = itemDivContainer.children.length;
            itemsNumberSpan.textContent = itemDivContainer.children.length; 

            totalItems1Div.textContent = itemDivContainer.children.length;
            itemsNumberSpan.textContent = itemDivContainer.children.length;

            var totalItemsPrice = Array.from(itemDivContainer.children).reduce(function (total, item) {
                var itemPrice = parseFloat(item.querySelector('.name-text#price').textContent.replace('£', ''));
                return total + itemPrice;
            }, 0);

            priceDiv.textContent = '£' + totalItemsPrice.toFixed(2);
        }


        function handlePay(){
            var check = document.getElementById('item-div');
            if (check.children.length != 0){
                window.location.href = '../../pay/pay.html';
            }
            else{
                alert('Please add items to cart');
            }
        }

    </script>

    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
